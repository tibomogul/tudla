<div id="today_list" data-controller="sortable" data-sortable-list-value="today" data-sortable-reorder-url-value="<%= reorder_today_tasks_path %>" class="space-y-2">
  <% @today_tasks.each_with_index do |task, idx| %>
    <div data-task-id="<%= task.id %>" class="card bg-base-100 shadow p-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span data-handle class="cursor-move iconify lucide--grip-vertical size-4"></span>
          <p class="font-medium"><%= link_to display_name_with_nice_to_have(task), task_path(task), class: "hover:underline" %></p>
        </div>
        <div class="flex items-center gap-2">
          <% allowed_states = task.state_machine.allowed_transitions %>
          <% allowed_states.each do |state| %>
            <%= button_to state.to_s.humanize,
              update_state_task_path(task, state: state),
              method: :patch,
              data: { turbo_stream: true },
              class: "btn btn-xs #{button_color(state)}" %>
          <% end %>
          <%= button_to "Backlog", move_to_backlog_task_path(task), method: :patch, data: { turbo_stream: true }, class: "btn btn-xs btn-outline" %>
        </div>
      </div>
      <div class="mt-1 text-sm text-base-content/70">
        <% if task.project_id && task.scope_id %>
          <span><%= task.project.name %> &gt; <%= display_name_with_nice_to_have(task.scope) %></span>
        <% end %>
        <% if task.due_at.present? %>
          <span class="ms-2 <%= task.due_at < Time.current ? 'text-error' : '' %>">Due: <%= l task.due_at, format: :short %></span>
        <% end %>
        <span class="badge badge-outline ms-2"><%= task.current_state.humanize %></span>
      </div>
    </div>
  <% end %>
</div>
