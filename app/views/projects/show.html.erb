<% content_for :title, "Showing project" %>

<div class="md:w-2/3 w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <!-- Header with breadcrumbs -->
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-2">
      <h1 class="font-bold text-2xl"><%= @project.name %></h1>
    </div>
    <div class="breadcrumbs hidden p-0 text-sm sm:inline">
      <ul>
        <li><%= link_to "Dashboard", user_root_path %></li>
        <li><%= link_to "Projects", projects_path %></li>
        <li class="opacity-80"><%= "PR-#{@project.id}" %></li>
      </ul>
    </div>
  </div>
  <%= render partial: "shared/subscribable_subscription", locals: { subscribable: @subscribable } %>

  <div role="tablist" class="tabs tabs-boxed my-4">
    <%= link_to "Details",
      project_path(@project),
      class: "tab #{'tab-active' if action_name == 'show'}",
      data: { turbo_frame: dom_id(@project, :risk) } %>

    <%= link_to "Risk History",
      risk_history_project_path(@project),
      class: "tab #{'tab-active' if action_name == 'risk_history'}",
      data: { turbo_frame: dom_id(@project, :risk) } %>
  </div>

  <%= turbo_frame_tag dom_id(@project, :risk) do %>
    <%= render partial: "risk_details", locals: { project: @project } %>
  <% end %>

  <!-- Hill Chart Card -->
  <div class="card bg-base-100 shadow-sm mt-6">
    <div class="card-body p-4">
      <h3 class="font-semibold text-base mb-3 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
        </svg>
        Hill Chart Progress
      </h3>
      <div data-controller="hillchart" data-hillchart-dots-value="<%= @dots.to_json %>">
        <div id="chart"></div>
      </div>
    </div>
  </div>
  <%#= render partial: "shared/task_ave_hours_in_state", locals: { results: @results, name: @project.name } %>
  
  <!-- Scopes Section -->
  <div class="mt-6">
    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
      </svg>
      Scopes
    </h2>
    <%= render partial: "projects/scopes_list", locals: { project: @project } %>
  </div>

  <!-- Quick Add Form -->
  <%= render partial: "scopes/quick_add_form", locals: { project: @project } %>
  
  <div class="flex flex-wrap gap-2 mt-4">
    <% if policy(Report).create? %>
      <%= link_to new_report_path(reportable_id: @project.id, reportable_type: "Project"), class: "btn btn-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        Create Report
      <% end %>
    <% end %>
    <%= link_to "Edit this project", edit_project_path(@project), class: "btn btn-soft" if policy(@project).edit? %>
    <%= link_to "Back to projects", projects_path, class: "btn btn-soft" %>
    <%= button_to "Destroy this project", @project, method: :delete, form_class: "inline-block", class: "btn btn-soft btn-secondary", data: { turbo_confirm: "Are you sure?" } if policy(@project).destroy? %>
  </div>

  <!-- Recent Reports Section -->
  <%= render "shared/recent_reports", recent_reports: @recent_reports %>

  <!-- Attachments Section -->
  <%= render "shared/attachments_section", record: @project, can_upload: policy(@project).update? %>

  <!-- Notes Section -->
  <%= render "shared/notes_section", record: @project, can_create: policy(@project).update? %>

  <!-- Links Section -->
  <%= render "shared/links_section", record: @project, can_create: policy(@project).update? %>
</div>
