<% content_for :title, "Showing scope" %>

<div class="md:w-2/3 w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <!-- Header with breadcrumbs -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="font-bold text-2xl"><%= display_name_with_nice_to_have(@scope) %></h1>
    <div class="breadcrumbs hidden p-0 text-sm sm:inline">
      <ul>
        <li><%= link_to "Dashboard", user_root_path %></li>
        <% if @scope.project %>
          <li><%= link_to @scope.project.name, @scope.project %></li>
        <% end %>
        <li><%= link_to "Scopes", scopes_path %></li>
        <li class="opacity-80"><%= "S-#{@scope.id}" %></li>
      </ul>
    </div>
  </div>

  <!-- Scope Details Card -->
  <%= render @scope %>

  <!-- Hill Chart Card -->
  <div class="card bg-base-100 shadow-sm mt-6">
    <div class="card-body p-4">
      <h3 class="font-semibold text-base mb-3 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
        </svg>
        Hill Chart Progress
      </h3>
      <div data-controller="hillchart" data-hillchart-dots-value="<%= @dots.to_json %>">
        <div id="chart"></div>
      </div>
    </div>
  </div>

  <!-- Tasks Section -->
  <div class="mt-6">
    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
      </svg>
      Tasks
    </h2>
    <%= render partial: "shared/task_list_sortable", locals: { tasks: @tasks, container_id: dom_id(@scope, :task_list), reorder_url: reorder_tasks_scope_path(@scope) } %>
  </div>

  <!-- Quick Add Form -->
  <%= render partial: "tasks/quick_add_form", locals: { scope: @scope } %>

  <!-- Attachments Section -->
  <%= render "shared/attachments_section", record: @scope, can_upload: policy(@scope).update? %>

  <!-- Notes Section -->
  <%= render "shared/notes_section", record: @scope, can_create: policy(@scope).update? %>

  <!-- Links Section -->
  <%= render "shared/links_section", record: @scope, can_create: policy(@scope).update? %>

  <!-- Actions -->
  <div class="flex flex-wrap gap-2 mt-6">
    <%= link_to "Edit this scope", edit_scope_path(@scope), class: "btn btn-soft" if policy(@scope).edit? %>
    <%= link_to "Back to scopes", scopes_path, class: "btn btn-soft" if policy(Scope).index? %>
    <%= button_to "Destroy this scope", @scope, method: :delete, form_class: "inline-block", class: "btn btn-soft btn-secondary", data: { turbo_confirm: "Are you sure?" } if policy(@scope).destroy? %>
  </div>
</div>
